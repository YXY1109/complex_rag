# å¤æ‚RAGæœåŠ¡ç³»ç»Ÿ

åŸºäºå¤šæ¨¡æ€æ–‡æ¡£è§£æå’Œæ™ºèƒ½æ£€ç´¢çš„é«˜çº§RAGï¼ˆRetrieval-Augmented Generationï¼‰æœåŠ¡ç³»ç»Ÿã€‚

## ğŸš€ ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½
- **å¤šæ¨¡æ€æ–‡æ¡£è§£æ**: æ”¯æŒPDFã€Wordã€Excelã€PowerPointã€å›¾ç‰‡ã€ç½‘é¡µç­‰å¤šç§æ ¼å¼
- **æ™ºèƒ½æ£€ç´¢å¼•æ“**: å‘é‡æ£€ç´¢ã€å…¨æ–‡æ£€ç´¢ã€è¯­ä¹‰æ£€ç´¢ã€æ··åˆæ£€ç´¢
- **é«˜çº§ç”ŸæˆæœåŠ¡**: æ”¯æŒå¤šç§LLMæ¨¡å‹ï¼Œé“¾å¼æ€è€ƒã€æ–‡æ¡£æ‘˜è¦ã€å†…å®¹æ¯”è¾ƒ
- **å¯¹è¯ç³»ç»Ÿ**: å¤šè½®å¯¹è¯ã€ä¼šè¯ç®¡ç†ã€ä¸Šä¸‹æ–‡ä¿æŒ
- **çŸ¥è¯†åº“ç®¡ç†**: å¤šç§Ÿæˆ·æ”¯æŒã€æƒé™æ§åˆ¶ã€ç‰ˆæœ¬ç®¡ç†

### æŠ€æœ¯ç‰¹æ€§
- **ç°ä»£æ¶æ„**: åŸºäºFastAPI + SQLAlchemy + Pydanticçš„å¼‚æ­¥æ¶æ„
- **é«˜æ€§èƒ½**: æ”¯æŒå¹¶å‘å¤„ç†ã€æµå¼å“åº”ã€æ‰¹é‡æ“ä½œ
- **å¯æ‰©å±•**: æ’ä»¶åŒ–æ¶æ„ã€å¾®æœåŠ¡è®¾è®¡ã€å®¹å™¨åŒ–éƒ¨ç½²
- **é«˜å¯ç”¨**: å¤šçº§ç¼“å­˜ã€æ•…éšœè½¬ç§»ã€å¥åº·æ£€æŸ¥
- **å¯è§‚æµ‹**: ç»“æ„åŒ–æ—¥å¿—ã€æ€§èƒ½ç›‘æ§ã€åˆ†å¸ƒå¼è¿½è¸ª

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   API Gateway   â”‚    â”‚   FastAPI App   â”‚    â”‚   RAG Engine    â”‚
â”‚   (Nginx)       â”‚â”€â”€â”€â”€â”‚   (RESTful)     â”‚â”€â”€â”€â”€â”‚   (Core Logic)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                        â”‚
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚                               â”‚                               â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Vector Store   â”‚                â”‚   Generation    â”‚                â”‚  Knowledge Mgr  â”‚
        â”‚  (Milvus)       â”‚                â”‚  (OpenAI/...)   â”‚                â”‚  (Multi-tenant) â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚                               â”‚                               â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚    Search DB    â”‚                â”‚     Cache       â”‚                â”‚  Object Storage â”‚
        â”‚ (Elasticsearch) â”‚                â”‚   (Redis)       â”‚                â”‚   (MinIO/S3)    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚                               â”‚                               â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Database      â”‚                â”‚   Monitoring    â”‚                â”‚ Document Parser â”‚
        â”‚   (MySQL)       â”‚                â”‚(Prometheus/Graf)â”‚                â”‚   (RAGFlow)      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“‹ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- Docker & Docker Compose
- Python 3.9+ (å¼€å‘ç¯å¢ƒ)
- 8GB+ RAM
- 20GB+ ç£ç›˜ç©ºé—´

### 1. å…‹éš†é¡¹ç›®

```bash
git clone <repository-url>
cd complex-rag
```

### 2. é…ç½®ç¯å¢ƒ

```bash
# å¤åˆ¶ç¯å¢ƒé…ç½®æ–‡ä»¶
cp .env.example .env

# ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œè®¾ç½®APIå¯†é’¥ç­‰
vim .env
```

### 3. å¯åŠ¨æœåŠ¡

#### é€‰é¡¹1ï¼šç»Ÿä¸€FastAPIæœåŠ¡ï¼ˆæ¨èï¼‰

```bash
# Linux/macOS
./deploy-unified.sh deploy

# Windows
deploy-unified.bat
```

#### é€‰é¡¹2ï¼šä¼ ç»Ÿéƒ¨ç½²æ–¹å¼

```bash
# å¼€å‘ç¯å¢ƒ
./deployment/scripts/deploy.sh dev --build --seed

# ç”Ÿäº§ç¯å¢ƒ
./deployment/scripts/deploy.sh prod --build --migrate
```

### 4. éªŒè¯éƒ¨ç½²

#### ç»Ÿä¸€æœåŠ¡

```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
curl http://localhost:8000/health/ping

# æŸ¥çœ‹è¯¦ç»†å¥åº·çŠ¶æ€
curl http://localhost:8000/health/detailed

# æŸ¥çœ‹APIæ–‡æ¡£
open http://localhost:8000/docs

# æŸ¥çœ‹OpenAPIè§„èŒƒ
open http://localhost:8000/openapi.json
```

#### ç®¡ç†å‘½ä»¤

```bash
# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
./deploy-unified.sh logs

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
./deploy-unified.sh status

# é‡å¯æœåŠ¡
./deploy-unified.sh update

# åœæ­¢æœåŠ¡
./deploy-unified.sh stop

# æ¸…ç†éƒ¨ç½²
./deploy-unified.sh cleanup
```

#### ç‹¬ç«‹æœåŠ¡ç«¯ç‚¹

ç»Ÿä¸€æœåŠ¡åŒ…å«ä»¥ä¸‹ä¸»è¦ç«¯ç‚¹ï¼š

- **èŠå¤©æœåŠ¡**: `POST /v1/chat/completions`
- **åµŒå…¥æœåŠ¡**: `POST /v1/embeddings/`
- **é‡æ’åºæœåŠ¡**: `POST /v1/rerank/`
- **è®°å¿†ç®¡ç†**: `/v1/memory/*`
- **å¥åº·æ£€æŸ¥**: `/health/*`

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡

| å˜é‡å | è¯´æ˜ | é»˜è®¤å€¼ |
|--------|------|--------|
| `OPENAI_API_KEY` | OpenAI APIå¯†é’¥ | - |
| `MYSQL_HOST` | MySQLä¸»æœºåœ°å€ | localhost |
| `MILVUS_HOST` | Milvusä¸»æœºåœ°å€ | localhost |
| `ELASTICSEARCH_HOSTS` | Elasticsearchåœ°å€ | localhost:9200 |
| `REDIS_HOST` | Redisä¸»æœºåœ°å€ | localhost |
| `MINIO_ENDPOINT` | MinIOç«¯ç‚¹ | localhost:9000 |

### ä¸»è¦é…ç½®æ–‡ä»¶

- `config.json` - ä¸»é…ç½®æ–‡ä»¶
- `docker-compose.yml` - ç”Ÿäº§ç¯å¢ƒå®¹å™¨ç¼–æ’
- `docker-compose.dev.yml` - å¼€å‘ç¯å¢ƒå®¹å™¨ç¼–æ’
- `deployment/nginx/` - Nginxé…ç½®
- `deployment/prometheus/` - ç›‘æ§é…ç½®

## ğŸ“š ä½¿ç”¨æŒ‡å—

### APIæ¥å£

#### RAGæŸ¥è¯¢
```bash
curl -X POST "http://localhost:8000/api/v1/rag/query" \
  -H "Content-Type: application/json" \
  -d '{
    "query": "ä»€ä¹ˆæ˜¯äººå·¥æ™ºèƒ½ï¼Ÿ",
    "retrieval_mode": "hybrid",
    "top_k": 5
  }'
```

#### åˆ›å»ºçŸ¥è¯†åº“
```bash
curl -X POST "http://localhost:8000/api/v1/knowledge" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "æŠ€æœ¯æ–‡æ¡£çŸ¥è¯†åº“",
    "description": "åŒ…å«å„ç§æŠ€æœ¯æ–‡æ¡£çš„çŸ¥è¯†åº“"
  }'
```

#### ä¸Šä¼ æ–‡æ¡£
```bash
curl -X POST "http://localhost:8000/api/v1/documents/{kb_id}/file" \
  -F "file=@document.pdf" \
  -F "title=æŠ€æœ¯æ–‡æ¡£"
```

#### èŠå¤©å¯¹è¯
```bash
curl -X POST "http://localhost:8000/api/v1/chat/sessions" \
  -H "Content-Type: application/json" \
  -d '{
    "title": "æŠ€æœ¯å­¦ä¹ å¯¹è¯",
    "knowledge_bases": ["kb_id"]
  }'

curl -X POST "http://localhost:8000/api/v1/chat/sessions/{session_id}/chat" \
  -H "Content-Type: application/json" \
  -d '{
    "message": "Pythonæ˜¯ä»€ä¹ˆï¼Ÿ"
  }'
```

### Python SDK

```python
import asyncio
from rag_service.api.main import create_app
from rag_service.examples.basic_usage import basic_qa_example

async def main():
    # åŸºç¡€é—®ç­”
    await basic_qa_example()

if __name__ == "__main__":
    asyncio.run(main())
```

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### å¼€å‘ç¯å¢ƒè®¾ç½®

```bash
# å®‰è£…ä¾èµ–
pip install uv
uv sync

# å¯åŠ¨å¼€å‘æœåŠ¡
uv run python -m rag_service.api.main
```

### ä»£ç ç»“æ„

```
rag_service/
â”œâ”€â”€ api/                    # APIå±‚
â”‚   â”œâ”€â”€ routes/            # è·¯ç”±å®šä¹‰
â”‚   â”œâ”€â”€ middleware/        # ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ dependencies/      # ä¾èµ–æ³¨å…¥
â”‚   â””â”€â”€ exceptions/        # å¼‚å¸¸å¤„ç†
â”œâ”€â”€ core/                  # æ ¸å¿ƒå±‚
â”‚   â””â”€â”€ rag_engine.py      # RAGå¼•æ“
â”œâ”€â”€ services/              # æœåŠ¡å±‚
â”‚   â”œâ”€â”€ vector_store.py    # å‘é‡å­˜å‚¨
â”‚   â”œâ”€â”€ embedding_service.py # åµŒå…¥æœåŠ¡
â”‚   â”œâ”€â”€ knowledge_manager.py # çŸ¥è¯†ç®¡ç†
â”‚   â””â”€â”€ ...
â”œâ”€â”€ infrastructure/        # åŸºç¡€è®¾æ–½å±‚
â”‚   â”œâ”€â”€ database/         # æ•°æ®åº“
â”‚   â”œâ”€â”€ cache/           # ç¼“å­˜
â”‚   â”œâ”€â”€ storage/         # å­˜å‚¨
â”‚   â””â”€â”€ monitoring/      # ç›‘æ§
â”œâ”€â”€ document_parsing/     # æ–‡æ¡£è§£æå±‚
â”‚   â”œâ”€â”€ processors/      # å¤„ç†å™¨
â”‚   â”œâ”€â”€ pipeline/        # ç®¡é“
â”‚   â””â”€â”€ strategy/        # ç­–ç•¥
â”œâ”€â”€ interfaces/           # æ¥å£å±‚
â””â”€â”€ examples/            # ç¤ºä¾‹ä»£ç 
```

### æ·»åŠ æ–°åŠŸèƒ½

1. åœ¨`interfaces/`ä¸­å®šä¹‰æŠ½è±¡æ¥å£
2. åœ¨`services/`ä¸­å®ç°æœåŠ¡é€»è¾‘
3. åœ¨`api/routes/`ä¸­æ·»åŠ APIç«¯ç‚¹
4. åœ¨`examples/`ä¸­æä¾›ä½¿ç”¨ç¤ºä¾‹
5. æ›´æ–°æ–‡æ¡£å’Œæµ‹è¯•

## ğŸ“Š ç›‘æ§å’Œè¿ç»´

### å¥åº·æ£€æŸ¥

```bash
# åŸºç¡€å¥åº·æ£€æŸ¥
curl http://localhost:8000/health

# è¯¦ç»†å¥åº·æ£€æŸ¥
curl http://localhost:8000/health/detailed

# å°±ç»ªæ£€æŸ¥
curl http://localhost:8000/health/ready
```

### ç›‘æ§æœåŠ¡

- **Grafana**: http://localhost:3000 (admin/admin)
- **Prometheus**: http://localhost:9090
- **MinIO**: http://localhost:9001 (minioadmin/minioadmin)

### è¿ç»´è„šæœ¬

```bash
# éƒ¨ç½²æœåŠ¡
./deployment/scripts/deploy.sh prod --build --migrate

# å¤‡ä»½æ•°æ®
./deployment/scripts/backup.sh prod all

# ç›‘æ§æ£€æŸ¥
./deployment/scripts/monitor.sh prod all

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f rag-api
```

### æ€§èƒ½è°ƒä¼˜

1. **æ•°æ®åº“ä¼˜åŒ–**
   - è°ƒæ•´MySQLç¼“å†²æ± å¤§å°
   - ä¼˜åŒ–æŸ¥è¯¢ç´¢å¼•
   - å¯ç”¨æŸ¥è¯¢ç¼“å­˜

2. **å‘é‡æœç´¢ä¼˜åŒ–**
   - è°ƒæ•´Milvusç´¢å¼•å‚æ•°
   - ä¼˜åŒ–å‘é‡ç»´åº¦
   - ä½¿ç”¨æ‰¹é‡æ“ä½œ

3. **ç¼“å­˜ç­–ç•¥**
   - é…ç½®Redisç¼“å­˜ç­–ç•¥
   - ä½¿ç”¨å¤šçº§ç¼“å­˜
   - è®¾ç½®åˆç†çš„TTL

## ğŸ”’ å®‰å…¨é…ç½®

### åŸºç¡€å®‰å…¨

- æ›´æ”¹é»˜è®¤å¯†ç 
- å¯ç”¨HTTPS/TLS
- é…ç½®é˜²ç«å¢™
- é™åˆ¶APIè®¿é—®é¢‘ç‡

### æ•°æ®åŠ å¯†

- æ•°æ®åº“è¿æ¥åŠ å¯†
- å¯¹è±¡å­˜å‚¨åŠ å¯†
- ä¼ è¾“è¿‡ç¨‹åŠ å¯†
- æ•æ„Ÿä¿¡æ¯è„±æ•

### è®¿é—®æ§åˆ¶

- JWTè®¤è¯
- RBACæƒé™æ§åˆ¶
- å¤šç§Ÿæˆ·éš”ç¦»
- APIå¯†é’¥ç®¡ç†

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

### åŸºå‡†æ€§èƒ½

- **QPS**: 100+ (å•å®ä¾‹)
- **å“åº”æ—¶é—´**: < 500ms (P95)
- **å¹¶å‘ç”¨æˆ·**: 1000+
- **æ–‡æ¡£å¤„ç†**: 10MB/s

### æ‰©å±•æ€§

- **æ°´å¹³æ‰©å±•**: æ”¯æŒå¤šå®ä¾‹éƒ¨ç½²
- **å­˜å‚¨æ‰©å±•**: æ”¯æŒåˆ†å¸ƒå¼å­˜å‚¨
- **è®¡ç®—æ‰©å±•**: æ”¯æŒGPUåŠ é€Ÿ
- **ç½‘ç»œæ‰©å±•**: æ”¯æŒè´Ÿè½½å‡è¡¡

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Forké¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. æ¨é€åˆ°åˆ†æ”¯
5. åˆ›å»ºPull Request

### å¼€å‘è§„èŒƒ

- éµå¾ªPEP 8ä»£ç é£æ ¼
- æ·»åŠ ç±»å‹æ³¨è§£
- ç¼–å†™å•å…ƒæµ‹è¯•
- æ›´æ–°æ–‡æ¡£

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯ï¼Œè¯¦è§[LICENSE](LICENSE)æ–‡ä»¶ã€‚

## ğŸ†˜ æ”¯æŒ

- **æ–‡æ¡£**: [é¡¹ç›®æ–‡æ¡£](docs/)
- **é—®é¢˜åé¦ˆ**: [GitHub Issues](issues)
- **è®¨è®º**: [GitHub Discussions](discussions)
- **é‚®ä»¶**: support@example.com

## ğŸ—ºï¸ è·¯çº¿å›¾

### v1.1 (è®¡åˆ’ä¸­)
- [ ] æ”¯æŒæ›´å¤šLLMæ¨¡å‹
- [ ] å¢å¼ºæ–‡æ¡£è§£æèƒ½åŠ›
- [ ] ä¼˜åŒ–å‘é‡æœç´¢ç®—æ³•
- [ ] å¢åŠ Webç®¡ç†ç•Œé¢

### v1.2 (è®¡åˆ’ä¸­)
- [ ] æ”¯æŒæ’ä»¶ç³»ç»Ÿ
- [ ] å¢åŠ æ•°æ®ç‰ˆæœ¬ç®¡ç†
- [ ] ä¼˜åŒ–å¤šè¯­è¨€æ”¯æŒ
- [ ] å¢å¼ºå®‰å…¨åŠŸèƒ½

### v2.0 (è¿œæœŸè§„åˆ’)
- [ ] æ”¯æŒåˆ†å¸ƒå¼éƒ¨ç½²
- [ ] å¢åŠ AIè¾…åŠ©åŠŸèƒ½
- [ ] æ”¯æŒå®æ—¶åä½œ
- [ ] å¢åŠ ç§»åŠ¨ç«¯æ”¯æŒ

---

**æ³¨æ„**: è¿™æ˜¯ä¸€ä¸ªå¤æ‚çš„ä¼ä¸šçº§RAGç³»ç»Ÿï¼Œå»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å‰è¿›è¡Œå……åˆ†çš„æµ‹è¯•å’Œå®‰å…¨è¯„ä¼°ã€‚

## å­¦ä¹ è®°å½•

- k8sæ•™ç¨‹ï¼š https://www.bilibili.com/video/BV1MT411x7GH/?p=29
- transformersæ•™ç¨‹ï¼šhttps://www.bilibili.com/video/BV1KX4y1a7Jk
- pythoné«˜çº§è¿›é˜¶ï¼šå¼€å§‹çœ‹ç¬¬ä¸ƒç« 